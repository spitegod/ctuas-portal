<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Панель заведующего кафедрой</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      color: #333;
      padding-top: 60px;
    }
.sidebar {
  width: 220px;
  background-color: #e6f0ff;
  padding: 10px 20px;
  position: fixed;
  top: 70px;
  bottom: 0;
  left: 0;
  overflow-y: auto;
  border-top-right-radius: 10px;
  border-bottom-right-radius: 10px;
}

/* Общий стиль кнопок */
.tab-button {
  display: block;
  background-color: transparent;
  color: #2075d6;
  padding: 12px 20px;
  margin-bottom: 10px;
  border-radius: 15px;
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: background-color 0.3s, color 0.3s;
}

/* При наведении */
.tab-button:hover {
  background-color: #cfe2ff;
  color: #125cb0;
}

/* Активная вкладка */
.tab-button.active {
  background-color: #2075d6;
  color: white;
  font-weight: 600;
}

    .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #1976d2;
        padding: 6px 14px 6px 10px;
        height: 60px;
        color: white;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
    }
    .topbar .logo-section {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .topbar .logo-section img {
        height: 36px;
        margin-right: 12px;
    }
    .topbar .logo-section span {
        font-size: 18px;
        font-weight: bold;
        color: white;
    }
    .profile-box {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: white;
      color: #3c8dbc;
      padding: 6px 14px 6px 10px; /* сверху/снизу и по бокам */
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .profile-box .avatar {
      width: 32px;
      height: 32px;
      background-color: #3c8dbc;
      color: white;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .dropdown-menu-profile {
        display: none;
        position: absolute;
        top: 110%;
        right: 0;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 6px;
        min-width: 140px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        z-index: 1100;
    }
    .dropdown-menu-profile a {
        display: block;
        padding: 10px 14px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
    }
    .dropdown-menu-profile a:hover {
      background-color: #f5f5f5;
    }
    .profile-box.open .dropdown-menu-profile {
      display: block;
    }
    .content {
      margin-left: 240px;
      padding: 20px;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-radius: 6px;
    overflow: hidden;
    }

    th {
        background-color: #1976d2;
        color: white;
        font-weight: bold;
        text-align: left;
        padding: 10px 12px;
        text-transform: uppercase;
        font-size: 14px;
    }

    td {
        padding: 10px 12px;
        border-top: 1px solid #e0e0e0;
        font-size: 14px;
    }

    tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    h1, h2 {
      margin-top: 20px;
    }
    button,
        input[type="submit"] {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 8px 18px;
            text-transform: uppercase;
            font-weight: bold;
            border-radius: 6px;
            margin: 6px 4px 6px 0;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

button:hover,
input[type="submit"]:hover {
    background-color: #1565c0;
}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="logo-section">
      <img src="/static/images/vstu-logo.jpg" alt="Logo">
      <span>ЦТУАС</span>
    </div>
    <div class="profile-box" onclick="event.stopPropagation(); toggleProfileMenu();">
      <div class="avatar">{{ last_initial }}</div>
      <span>{{ request.user.teacher.full_name }}</span>
      <div class="dropdown-menu-profile" id="profileDropdown">
        <a href="#">Профиль</a>
        <a href="{% url 'logout' %}">Выйти</a>
      </div>
    </div>
  </div>

    <div class="sidebar">
    <a href="#" class="tab-button active" onclick="showTab('tab1')" id="btn_tab1">Сотрудники</a>
    <a href="#" class="tab-button" onclick="showTab('tab2')" id="btn_tab2">Уровни доступа</a>
    <a href="#" class="tab-button" onclick="showTab('tab3')" id="btn_tab3">ИП преподавателей</a>
    <a href="#" class="tab-button" onclick="showTab('tab4')" id="btn_tab4">ППС</a>
    </div>

    <div class="content">
        <!-- Вкладка 1: Сотрудники -->
        <div id="tab1" class="tab-content">
            <h2>Сотрудники</h2>

            <h3>Список сотрудников</h3>
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Имя пользователя</th>
                    <th>Преподаватель</th>
                    <th>Администратор</th>
                </tr>
                </thead>
                <tbody>
                {% for user in staff_users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.is_staff|yesno:"Да,Нет" }}</td>
                        <td>{{ user.is_superuser|yesno:"Да,Нет" }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="4">Сотрудники не найдены</td></tr>
                {% endfor %}
                </tbody>
            </table>

            <h3>Добавить сотрудника</h3>
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="add">
                <label>Имя пользователя:</label>
                <input type="text" name="username" required>

                <label>Пароль:</label>
                <input type="password" name="password" required>

                <label>Преподаватель:</label>
                <select name="teacher_id">
                    <option value="">-- Новый преподаватель --</option>
                    {% for teacher in teachers %}
                        {% if not teacher.user %}
                            <option value="{{ teacher.id }}">{{ teacher.full_name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>

                <button type="submit">Добавить</button>
            </form>

            <h3>Удалить сотрудника</h3>
            <form method="post">
                {% csrf_token %}
                <select name="delete_user">
                    {% for user in staff_users %}
                        <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>
                <button type="submit" name="action" value="delete">Удалить</button>
            </form>
        </div>

        <!-- Вкладка 2: Уровни доступа -->
        <div id="tab2" class="tab-content">
            <h2>Уровни доступа</h2>

            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_permissions">

                <label>Выберите сотрудника:</label>
                <select name="user_id" required>
                    {% for user in staff_users %}
                        <option value="{{ user.id }}">{{ user.username }}</option>
                    {% endfor %}
                </select>

                <label>Права преподавателя:</label>
                <select name="is_staff" required>
                    <option value="True">Да</option>
                    <option value="False">Нет</option>
                </select>

                <label>Права администратора:</label>
                <select name="is_superuser" required>
                    <option value="True">Да</option>
                    <option value="False">Нет</option>
                </select>

                <button type="submit">Сохранить права</button>
            </form>

            {% if messages %}
                <ul class="message">
                    {% for message in messages %}
                        {% if "access" in message.tags %}
                            <li class="{{ message.tags }}">{{ message }}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

        <!-- Вкладка 3: ИП преподавателей -->
        <div id="tab3" class="tab-content">
            <h1>ИП преподавателей</h1>
            <p>Здесь можно просматривать и редактировать ИП преподавателей.</p>

            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="select_ip_teacher">
                
                <label><strong>Выберите преподавателя:</strong></label>
                <select name="selected_teacher_id" onchange="this.form.submit()">
                    <option value="">-- выберите преподавателя --</option>
                    {% for teacher in teachers %}
                        <option value="{{ teacher.id }}" {% if selected_teacher and selected_teacher.id == teacher.id %}selected{% endif %}>
                            {{ teacher.full_name }}
                        </option>
                    {% endfor %}
                </select>
            </form>


            <h2>Первый семестр</h2>
            <table>
                <tr>
                    <th>Дисциплины</th>
                    <th>Курс</th>
                    <th>Количество групп</th>
                    <th>Количество студентов</th>
                    <th>Лекции</th>
                    <th>Практические занятия</th>
                    <th>Лабораторные занятия</th>
                    <th>Курсовое проектирование</th>
                    <th>Консультации</th>
                    <th>Зачеты</th>
                    <th>Экзамены</th>
                    <th>Рецензирование контр.работ заочников</th>
                    <th>Руководство практиками студентов</th>
                    <th>Контрольное посещение занятий</th>
                    <th>Руководство квалификац. работами бакалавра, специалиста, магистра</th>
                    <th>Работа в ГЭК, ГАК</th>
                    <th>Прием вступительных и кандидатских экзаменов</th>
                    <th>Руководство аспирантами и соискателями</th>
                    <th>ОргСРС</th>
                    <th>Рейтинг</th>
                    <th>Всего часов по плану</th>
                    <th>Всего часов фактически</th>
                </tr>
                {% for d in disciplines_firstsem %}
                <tr>
                    <td>{{ d.discipline }}</td>
                    <td>{{ d.course|default_if_none:"" }}</td>
                    <td>{{ d.group_count|default_if_none:"" }}</td>
                    <td>{{ d.student_count|default_if_none:"" }}</td>
                    <td>{% if d.lectures %}{{ d.lectures }}{% endif %}</td>
                    <td>{% if d.practicals %}{{ d.practicals }}{% endif %}</td>
                    <td>{% if d.labs %}{{ d.labs }}{% endif %}</td>
                    <td>{% if d.project_work %}{{ d.project_work}}{% endif %}</td>
                    <td>{% if d.consultations %}{{ d.consultations }}{% endif %}</td>
                    <td>{% if d.tests %}{{ d.tests }}{% endif %}</td>
                    <td>{% if d.exams %}{{ d.exams }}{% endif %}</td>
                    <td>{% if d.review_distance %}{{ d.review_distance }}{% endif %}</td>
                    <td>{% if d.practice_supervision %}{{ d.practice_supervision }}{% endif %}</td>
                    <td>{% if d.visit_control %}{{ d.visit_control }}{% endif %}</td>
                    <td>{% if d.qualification_supervision %}{{ d.qualification_supervision }}{% endif %}</td>
                    <td>{% if d.committee_work %}{{ d.committee_work }}{% endif %}</td>
                    <td>{% if d.exam_commission %}{{ d.exam_commission }}{% endif %}</td>
                    <td>{% if d.phd_supervision %}{{ d.phd_supervision }}{% endif %}</td>
                    <td>{% if d.org_srs %}{{ d.org_srs}}{% endif %}</td>
                    <td>{% if d.rating %}{{ d.rating }}{% endif %}</td>
                    <td>{% if d.total_plan %}{{ d.total_plan }}{% endif %}</td>
                    <td>{% if d.total_actual %}{{ d.total_actual }}{% endif %}</td>
                </tr>
                {% endfor %}
            </table>
            <h2>Второй семестр</h2>
            <table>
                <tr>
                    <th>Дисциплины</th>
                    <th>Курс</th>
                    <th>Количество групп</th>
                    <th>Количество студентов</th>
                    <th>Лекции</th>
                    <th>Практические занятия</th>
                    <th>Лабораторные занятия</th>
                    <th>Курсовое проектирование</th>
                    <th>Консультации</th>
                    <th>Зачеты</th>
                    <th>Экзамены</th>
                    <th>Рецензирование контр.работ заочников</th>
                    <th>Руководство практиками студентов</th>
                    <th>Контрольное посещение занятий</th>
                    <th>Руководство квалификац. работами бакалавра, специалиста, магистра</th>
                    <th>Работа в ГЭК, ГАК</th>
                    <th>Прием вступительных и кандидатских экзаменов</th>
                    <th>Руководство аспирантами и соискателями</th>
                    <th>ОргСРС</th>
                    <th>Рейтинг</th>
                    <th>Всего часов по плану</th>
                    <th>Всего часов фактически</th>
                </tr>
                {% for d in discipines_secondsem %}
                <tr>
                    <td>{{ d.discipline }}</td>
                    <td>{{ d.course|default_if_none:"" }}</td>
                    <td>{{ d.group_count|default_if_none:"" }}</td>
                    <td>{{ d.student_count|default_if_none:"" }}</td>
                    <td>{% if d.lectures %}{{ d.lectures }}{% endif %}</td>
                    <td>{% if d.practicals %}{{ d.practicals }}{% endif %}</td>
                    <td>{% if d.labs %}{{ d.labs }}{% endif %}</td>
                    <td>{% if d.project_work %}{{ d.project_work}}{% endif %}</td>
                    <td>{% if d.consultations %}{{ d.consultations }}{% endif %}</td>
                    <td>{% if d.tests %}{{ d.tests }}{% endif %}</td>
                    <td>{% if d.exams %}{{ d.exams }}{% endif %}</td>
                    <td>{% if d.review_distance %}{{ d.review_distance }}{% endif %}</td>
                    <td>{% if d.practice_supervision %}{{ d.practice_supervision }}{% endif %}</td>
                    <td>{% if d.visit_control %}{{ d.visit_control }}{% endif %}</td>
                    <td>{% if d.qualification_supervision %}{{ d.qualification_supervision }}{% endif %}</td>
                    <td>{% if d.committee_work %}{{ d.committee_work }}{% endif %}</td>
                    <td>{% if d.exam_commission %}{{ d.exam_commission }}{% endif %}</td>
                    <td>{% if d.phd_supervision %}{{ d.phd_supervision }}{% endif %}</td>
                    <td>{% if d.org_srs %}{{ d.org_srs}}{% endif %}</td>
                    <td>{% if d.rating %}{{ d.rating }}{% endif %}</td>
                    <td>{% if d.total_plan %}{{ d.total_plan }}{% endif %}</td>
                    <td>{% if d.total_actual %}{{ d.total_actual }}{% endif %}</td>
                </tr>
                {% endfor %}
            </table>

            <h2>Учебно-методическая работа</h2>
            <table>
                <tr>
                    <th>Наименование работы</th>
                    <th>Начало работы</th>
                    <th>Окончание работы</th>
                    <th>Отметка о выполнении</th>
                </tr>
                {% for e in edu_methodwork %}
                <tr>
                    <td>{{ e.name }}</td>
                    <td>{{ e.start_date }}</td>
                    <td>{{ e.end_date }}</td>
                    <td>{{ e.status }}</td>
                    
                </tr>
                {% endfor %}
            </table>

            <h2>Организационно-методическая работа</h2>
            <table>
                <tr>
                    <th>Наименование работы</th>
                    <th>Начало работы</th>
                    <th>Окончание работы</th>
                    <th>Отметка о выполнении</th>
                </tr>
                {% for o in org_methodwork %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.start_date }}</td>
                    <td>{{ o.end_date }}</td>
                    <td>{{ o.status }}</td>
                    
                </tr>
                {% endfor %}
            </table>
            <h2>Научно-исследовательская работа</h2>
            <h3>(в пределах 6-тичасового рабочего дня)</h3>
            <table>
                <tr>
                    <th>Наименование темы, этап, задание</th>
                    <th>Начало</th>
                    <th>Окончание</th>
                    <th>Отметка о выполнении</th>
                </tr>
                
                {% for o in sci_researchwork %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.start_date }}</td>
                    <td>{{ o.end_date }}</td>
                    <td>{{ o.status }}</td>
                    
                </tr>
                {% endfor %}
                
            </table>
            <h2>Участие в хоздоговорной НИР</h2>
            <table>
                <tr>
                    <th>Наименование темы, шифр</th>
                    <th>Должность по НИР</th>
                    <th>Начало</th>
                    <th>Окончание</th>
                    <th>Отметка о выполнении</th>
                </tr>
                
                {% for o in contractwork %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.job }}</td>
                    <td>{{ o.start_date }}</td>
                    <td>{{ o.end_date }}</td>
                    <td>{{ o.status }}</td>
                    
                </tr>
                {% endfor %}
                
            </table>
            <h2>Научно-методическая работа</h2>
            <table>
                <tr>
                    <th>Наименование темы, этап, задание</th>
                    <th>Начало</th>
                    <th>Окончание</th>
                    <th>Отметка о выполнении</th>
                </tr>
                
                {% for o in sci_methodwork %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.start_date }}</td>
                    <td>{{ o.end_date }}</td>
                    <td>{{ o.status }}</td>
                    
                </tr>
                {% endfor %}
                
            </table>
            <h2>Перечень опубликованных научных и научно-методических работ в учебном году</h2>
            <table>
                <tr>
                    <th>№ п/п</th>
                    <th>Наименование и вид работы</th>
                    <th>Выходные данные</th>
                    <th>Объем в п.л.</th>
                    <th>Соавторы</th>
                </tr>
                
                {% for o in published_sciwork %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.job }}</td>
                    <td>{{ o.start_date }}</td>
                    <td>{{ o.end_date }}</td>
                    <td>{{ o.status }}</td>
                </tr>
                {% endfor %}
                
            </table>
            <h2>Общественная и воспитательная работа преподавателя в учебном году</h2>
            <table>
                <tr>
                    <th>Наименование работы</th>
                    <th>Отметка о выполнении</th>
                </tr>
                
                {% for o in public_work %}
                <tr>
                    <td>{{ o.name }}</td>
                    <td>{{ o.mark }}</td>
                </tr>
                {% endfor %}
                
            </table>

            <h2>Замечания о выполнении преподавателем плана работы за учебный год</h2>
            <table>
                <tr>
                    <th>Дата</th>
                    <th>Содержание замечаний</th>
                    <th>Роспись проверяющего</th>
                </tr>
                
                {% for o in remark %}
                <tr>
                    <td>{{ o.date }}</td>
                    <td>{{ o.remark }}</td>
                    <td>{{ o.signature }}</td>
                </tr>
                {% endfor %}
                
            </table>
            <h2>Повышение квалификации</h2>
            <table>
                <tr>
                    <th>Дата</th>
                    <th>Форма повышения квалификации</th>
                    <th>Отметка о выполнении</th>
                </tr>
                
                {% for o in raising %}
                <tr>
                    <td>{{ o.date }}</td>
                    <td>{{ o.form }}</td>
                    <td>{{ o.mark }}</td>
                </tr>
                {% endfor %}
                
            </table>

            <h2>Рекомендация кафедры по избранию преподавателя</h2>
            <table>
                
                {% for o in recommendation %}
                <tr>
                    <td>{{ o.recommendation }}</td>
                </tr>
                {% endfor %}
                
            </table>
        </div>

        <!-- Вкладка 4: ППС -->
        <div id="tab4" class="tab-content">
            <h2>Профессорско-преподавательский состав</h2>

            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="add_teacher">

                <label>ФИО:</label>
                <input type="text" name="full_name" required>

                <label>Тип:</label>
                <select name="teacher_type" required>
                    <option value="">--Выберите--</option>
                    <option value="Внутр">Внутр</option>
                    <option value="Шт">Шт</option>
                </select>

                <label>Должность:</label>
                <input type="text" name="position" required>

                <label>Ставка:</label>
                <input type="text" name="rate" required>

                <label>Степень:</label>
                <input type="text" name="degree">

                <label>Звание:</label>
                <input type="text" name="rank">

                <label>Почта:</label>
                <input type="email" name="email">

                <label>Телефон:</label>
                <input type="text" name="phone">

                <label>Дата рождения:</label>
                <input type="date" name="birthday">

                <label>Домашний адрес:</label>
                <input type="text" name="address">

                <button type="submit">Добавить преподавателя</button>
            </form>

            <h3>Список преподавателей</h3>
            <table>
                <tr>
                    <th>ID</th>
                    <th>ФИО</th>
                    <th>Тип</th>
                    <th>Должность</th>
                    <th>Ставка</th>
                    <th>Степень</th>
                    <th>Звание</th>
                    <th>Почта</th>
                    <th>Телефон</th>
                    <th>Дата рождения</th>
                    <th>Адрес</th>
                    <th>Логин</th>
                </tr>
                {% for teacher in teachers %}
                    <tr>
                        <td>{{ teacher.id }}</td>
                        <td>{{ teacher.full_name }}</td>
                        <td>{{ teacher.teacher_type }}</td>
                        <td>{{ teacher.position }}</td>
                        <td>{{ teacher.rate }}</td>
                        <td>{{ teacher.degree }}</td>
                        <td>{{ teacher.rank }}</td>
                        <td>{{ teacher.email }}</td>
                        <td>{{ teacher.phone }}</td>
                        <td>{{ teacher.birthday }}</td>
                        <td>{{ teacher.address }}</td>
                        <td>
                            {% if teacher.user %}
                                {{ teacher.user.username }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>

            <h3>Удалить преподавателя</h3>
            <form method="post">
                {% csrf_token %}
                <select name="delete_teacher" required>
                    {% for teacher in teachers %}
                        <option value="{{ teacher.id }}">{{ teacher.full_name }}</option>
                    {% endfor %}
                </select>
                <button type="submit" name="action" value="delete_teacher">Удалить</button>
            </form>


        </div>




    <script>
        function showTab(tabId) {
        const tabs = document.getElementsByClassName("tab-content");
        for (let tab of tabs) tab.classList.remove("active");
        const buttons = document.querySelectorAll(".sidebar a");
        for (let btn of buttons) btn.classList.remove("active");
        document.getElementById(tabId).classList.add("active");
        document.getElementById("btn_" + tabId).classList.add("active");
        localStorage.setItem("activeTab", tabId);
        }
        window.onload = () => {
        const savedTab = localStorage.getItem("activeTab") || "tab1";
        showTab(savedTab);
        };
        function toggleProfileMenu() {
        document.querySelector('.profile-box').classList.toggle('open');
        }
        document.addEventListener('click', function(e) {
        const box = document.querySelector('.profile-box');
        if (!box.contains(e.target)) box.classList.remove('open');
        });
    </script>
</body>
</html>